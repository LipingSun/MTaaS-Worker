cache:
  directories:
    - node_modules
language: node_js
node_js:
  - '5.12'
env:
  global:
  - secure: ys8pLVygLoxOhTBfZvo32HTIeoWz50SHD0fkrYUhxVZkZbjMrw43LGIDtJ6zIbBS3m3j6vEKE33fVWxyCf/lHHAxKrm0y2wnBfF2KkInDhP/IgozSu4Bkto1dZOGD7lWiPJIa1cAtdN1z2jHFOnNK9WYCt8shX1k8R4SBiyeAMRBMwhI+j4w8OGgKs+E5ucF+zq3sQy5Qp4n0Z6eiHqVnp6iOWCPh7Dj5vRQ331xG5wNfXpggpUoH1fGIkOG5qbVPjl0/Q/zlA3xZycWHijWccPs/JjL7mPTn9ZN4vhFYdM9VPL96VIJ4rI6wirc1vzZVnpmju5lFHJ0fnUij9YYCWInBdN3/+mEdIcedCAENvymUyhACxZo3okbCMpOLMpNhGgstDgHD0TX3iTcEZ1pKYMUHYVcOVy2Hf/w2Z7B3PiudbDcg38Fmls0lFgYVq88XMcowZGAjATJNDwQuVM9NjWT8ghhhlS0UtG+b234zsDwjsPyhz0aEuJgiVW4NGNJHopd+wI3N7H0pwFZ8ELExPmrUepCFaDskPNeQAcc0wqM3nWkCsaYoEbt09njsqzdWnCwO8rSfZUA9oUzlJPUEqxu7cqlpt9ObpNV0jZSnSLaIDztnObvGkJtULaTfz6uoBB/cLb6hpvQRR/b1r7ShCM6FA3ZHB3lNskXz0SWmqo=
  - secure: eCq39zYU7zJj2jfxKJamnU4lofoC9AMXSCNHdotAQPl0SBu+HN9CXmOn5YHmeIC6MQlkI1SMfWsw/VpqFpTaRsQu0SylB9XpOtK8pdp5Y0EOxhOGn5J8TXX1vR0vgBXo05xHQ2/UG5OJ3cZ808rknL/uUzAL/8jLQ1tRRv3UdXXuLzZOLSwrY0YYf0u0QEkq5CO/1Yt4gd1UvbskjOlPQonjBJHaXER4PRhQRwUsaVXsYV0jNF77OWEq5RoZVsu948dYEqMvnvUVVg05FIE9Q4JNziHrTD6qp5GB8O8M8by/MzE+Mu/inkYWBo/lKkz7EFNiScoOSv/06vwIMV6srn/VjrmaYm2r5zXEU6o7IuypTr8bjOBHX148I4AtfjC8GaX1StnCru6AGF/hd2Sv40PJwhaygMdHZ7QUyMHLg8TxxQ/7yyxacHG83KWmasuxcgxu6nVmQ7mzNXLb96rONxsZ3PJGdPDZQ3W9mhhO6KrykRyU+Xa/2LiW1/WzqSFwiWgVuXlhD2dVFqgtJ2aqnNhVKAZ151oG/4ybDR5VRQwW6hua3s9wRbb9d/Bx/P4nTE298IH1U9Z1PDwdmFuNPcWSBf+JbGa1DaCOlNaOqPr8DyM43wH5jhMjUtVyKKo4X63Agfg+eDSA2ywDHwTLC5kh05mbjab31YzJmW2qI/E=
  - secure: mCEC52kPz+EMtW2JXjV90iIupJcudJWmEvdR0GX8A7k8qxrschCp8vk0bY9IafgLKsUOxeCId13V2V6Er6KHW43Z0jeOAOxmzp+dDp5fC7pKotP87f+j57LLY1mRWkANyHeIy4eKHePEZ+m1BeoVz1H1gA32Il/wabJQMzQOtfsVA3jXfvgsaqvV2FOMSYiS3NV03oWUVtrwcBKRj6ZisIfEegYRssDkrd+EWt6jFVLDPEzIHYovS0650sDFA1OjOhZw53mPNvwl1hh9zvCJju6WdbRikDgA9Fcaxa1i99Sm3NDnt2cZxQAaTSk651zl4PpYYqRsIzaZEgaiabu5w9ye/8VVTxPnbkmH/plD+5EIxgBT8PwyfswPIW2D0MtP4DLTgr1GWptIs/Qb5p5twsF/hdvm6bL7CMuVZ/YS3N2USeCj9tonFPe9X5/ohGOPehTe/IhGpng5naU+KZVEeN3B9Gp9bQG57yezZTfNgMC8HeIVb9g7tw6zGgqqn2FmXnVN4wshj+RX+R+siYRhnbKBFopzgaqe8nupSxmVYndpGjKMjoPsDtk2gUNt1iWngBfyC4wLMZ6KghAk64RXFZlK/P/JOiNqihaUpDU4yszcwu/qPOl84c3V1eu8GhvbnuEEJ52GPvo9hkSBk0eWNG6aKoSvyF0CQDjACP63wWo=
  - secure: VaPgKn8lg/xJphUSukZwbGmzDBmcTeOcBB2kMxfvQRQZS0/1UUk6/HTG/92ugDQ4OsonBj+SHIV88bQAakJaW8AKbr1IlJ7g+M8Q4b3L1Y/6Ek3dJgBB5jbECJz8SJnKwsYefA7LkoZ+pzgl/soIPEk0fYoCnLGCk5g6dJqgNio22+f9WQ0h2E/XEnjGtlPG+PebH0LmM0bw88/ee2tQQ7G6X5d4GWRQSJTXx5XIkdR2kLQ05PJX+UpwOHgm/TEdldyauRZ6KdOnONc2yE2AfWKuZZGW/9qh7XfPoY/xCrUmCZTb6AlsxrnPLm0DhttyaFM0bBQWJ29D+WHrRw8tIlNte4NxugzrYCyOmMvpsf9QAL61VHAUQm0Csfyd4ru+3wT297gpcoEVfy6qw94gYCtmT8AEzIpxR9rVJKKEnjGcCsfHtTR0OQ9foKL5SZfkCborQtE3nP9CW7Rni2HpLPAv6zRbaBZ7udokf/DO8TDwg7yKU+9RyIoaqN642feT/A4huXMCHlXiZFZMlT+uEAwNaiqj9Fvb6SC2B6j8Z2q93xdjlvI6Xadd4SiNv7ZIufjfsnAM61+iDjZ+/JpmShyb7zxaP0/Z6Gm2TePa524nD2JdLQok0F8kocIIeDz5895o6D934gBqOr/NKSfpd2fImgWtAPnj/zLetkay64g=

sudo: required
services:
  - docker
after_success:
  - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi
  - image=liping511/mtaas-worker:$(date +"%Y%m%d%H%M%S")
  - docker build -t $image --build-arg MONGODB_URI=$MONGODB_URI --build-arg JWT_SECRET=$JWT_SECRET .
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
  - docker push $image
before_deploy:
  - echo "{\"AWSEBDockerrunVersion\":\"1\",\"Image\":{\"Name\":\"$image\"},\"Ports\":[{\"ContainerPort\":\"3000\"}]}" > Dockerrun.aws.json
#deploy:
#  - provider: script
#    script: deploy/aws-beanstalk-docker.sh
#  - provider: elasticbeanstalk
#    access_key_id:
#      secure: bnFXGcDyGjWaIn3fgv33dTijJ6RmAUQSKWfCCwSkIyKYdKtyuDiTEzQYPQrQY9FkReOARrsqfVZAjeJSA8yePspvjGb0wmXfHRTxQBBXd6K6Ra/UBxmiOnNmadnHOEBSyEvntyLBVoY6UosIbCZz5lbBgRVfzsGAylKhiFvCgpShqZjrqJ4siSa7eIkafuoWy/PC7rFQG0RQ9pb+YB/wd4ppUdxVAHWLGWNL32pRwdYASen16qaRCtYEQjCQewSi5DbvHYCTbL2sFTiC/QWGB1vyVyrz9nxz5+TELblMCNCr580fGx9m53i9NoYYimZHFtb/ZT+GdKYltatn7K2jJictZyaOnXWzyodxiQt+s3pSYOa94ijZadTm2XWHJbO40jtwlqjXk2SRTykRhHInt1c8soRW5dUTxhtlEmHwZ46neGFy2qKhp7fGB5N454yGwyudptOOStCPDnmZFEzI1XYYhY2dd/ZIyuWez/xzJv2XgrScbQs2ATycfNdmnfT5+MoaFQY2xnW6ZhpjJLDoz4rHrqypM9OFqJPTfS3Ru/QVaq0H6DP6q8Ufms6LhPyqQPwToifeGj2hNZzE4Xi/w+vMyU0PwwkDdaXeDjKXGmHKPdSOQuhCP71UjHxVaNuV31ILSBf46tn+Bw/tV9GXhJKDBvxFs9pmW5mc+Wluuns=
#    secret_access_key:
#      secure: zOMCB313gPb/Yhdcj2rYFQcfykKmTEUJz/+FcT4Fu/lQCU0dBmVuqT8vVFXm2ayVa7e1xseg7I1yKHVZqQ+WLlyXUB+MxnAj/VVtLR+E0rsQg4NPoJ2jzxSUq/xzPTulqWxhdviTQqb7vTuxizAa+7vuknHvhiJh6nGiIEof0K5HTFmS20k+990OKibIRl/EwbPw5er/5mR3I6RHo7WLynkmHHZH8VhndXlsENRdNZl2trE2CjzLMJwSpMhOjNADGVFY3aYZEH9nDpSp7NiwgStdYqZ55I1ASIOYpgpSi71Fw8fzCrflJ1ztsD0WAz5BOx3qEYJjT0lD2sKM0fdbuqaxDqej84DAU+Pn3oJj/oROfIrCVkwMayX8C7cLOzUJ+SLDzSl1Kg4bxdtJZlVJHMAbSKdQkKzo+DD2z6VEOANBDX7G53TGygWsOC5o1gOi1UMHxOLeMme1V3SODN9ZDriGdh/2dfEdNQnsA6cBwXISvTRh//dz5d22i03tSiCKmYftb43ILFve+6nrCKwoPJ8iaHhXu1ClK64rlfyDyldSzqzLWTsz1jU9lP6HJd2iEF+s7a2XXkTDILjmMhNCRxTp5PfdxeqMQk5Zkr46kHKbApZ3cf6T6M3orn88MEw0tr785YNMkDApfpma2wZPzQETy5YhA2t6ofMBaEuYd5E=
#    region: us-west-2
#    app: MTaaS-Worker
#    env: mtaas-worker
#    zip_file: Dockerrun.aws.json